========================================
Audit App - Application Deployment
========================================

[1;33mConfiguration:[0m
  Environment: staging
  Resource Group: auditapp-staging-rg

[0;32mGetting deployment information...[0m
[0;32mGetting deployment information...[0m
  Container Registry: auditappstagingacrwgjuafflp2o4o
  Container Apps Environment: auditapp-staging-containerenv

[0;32mEnabling ACR admin access...[0m
{
  "adminUserEnabled": true,
  "anonymousPullEnabled": false,
  "autoGeneratedDomainNameLabelScope": "Unsecure",
  "creationDate": "2025-11-25T15:17:47.483680+00:00",
  "dataEndpointEnabled": false,
  "dataEndpointHostNames": [],
  "encryption": {
    "keyVaultProperties": null,
    "status": "disabled"
  },
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.ContainerRegistry/registries/auditappstagingacrwgjuafflp2o4o",
  "identity": null,
  "location": "eastus",
  "loginServer": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
  "metadataSearch": "Disabled",
  "name": "auditappstagingacrwgjuafflp2o4o",
  "networkRuleBypassOptions": "AzureServices",
  "networkRuleSet": null,
  "policies": {
    "azureAdAuthenticationAsArmPolicy": {
      "status": "enabled"
    },
    "exportPolicy": {
      "status": "enabled"
    },
    "quarantinePolicy": {
      "status": "disabled"
    },
    "retentionPolicy": {
      "days": 7,
      "lastUpdatedTime": "2025-11-25T15:39:46.744016+00:00",
      "status": "disabled"
    },
    "softDeletePolicy": {
      "lastUpdatedTime": "2025-11-25T15:39:46.744075+00:00",
      "retentionDays": 7,
      "status": "disabled"
    },
    "trustPolicy": {
      "status": "disabled",
      "type": "Notary"
    }
  },
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": "Enabled",
  "resourceGroup": "auditapp-staging-rg",
  "roleAssignmentMode": "LegacyRegistryPermissions",
  "sku": {
    "name": "Basic",
    "tier": "Basic"
  },
  "status": null,
  "systemData": {
    "createdAt": "2025-11-25T15:17:47.483680+00:00",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:45:54.217616+00:00",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "tags": {
    "Application": "AuditApp",
    "Environment": "staging",
    "ManagedBy": "Bicep"
  },
  "type": "Microsoft.ContainerRegistry/registries",
  "zoneRedundancy": "Disabled"
}

[0;32mBuilding and pushing Docker images...[0m
[1;33mBuilding backend image...[0m
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon    542MB
Step 1/12 : FROM python:3.12-slim
 ---> 445121148b18
Step 2/12 : WORKDIR /app
 ---> Using cache
 ---> 2284d0cea4d9
Step 3/12 : RUN apt-get update && apt-get install -y     gcc     g++     libpq-dev     libmagic1     curl     && rm -rf /var/lib/apt/lists/*
 ---> Using cache
 ---> f6873aac0949
Step 4/12 : COPY requirements.txt .
 ---> Using cache
 ---> 5040f9f29a4e
Step 5/12 : RUN pip install --no-cache-dir -r requirements.txt &&     pip install --no-cache-dir 'numpy<2.0'
 ---> Using cache
 ---> 171d93300fb0
Step 6/12 : COPY app/ ./app/
 ---> Using cache
 ---> cda25bedbf5e
Step 7/12 : RUN mkdir -p /app/data
 ---> Using cache
 ---> 8990d9f4e541
Step 8/12 : RUN useradd -m -u 1000 appuser &&     chown -R appuser:appuser /app
 ---> Using cache
 ---> 49cd4d6d5184
Step 9/12 : USER appuser
 ---> Using cache
 ---> f3f615032def
Step 10/12 : HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3     CMD curl -f http://localhost:8000/health || exit 1
 ---> Using cache
 ---> f3305ba024d6
Step 11/12 : EXPOSE 8000
 ---> Using cache
 ---> ddf4cd3ae6b9
Step 12/12 : CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
 ---> Using cache
 ---> 500f08690da3
Successfully built 500f08690da3
Successfully tagged auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend:latest
[1;33mPushing backend image...[0m
Login Succeeded
The push refers to repository [auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend]
17856622c495: Preparing
e714c748e694: Preparing
28a1f81af219: Preparing
bc251b2c8478: Preparing
1a8392a4176e: Preparing
a6d5ef62e042: Preparing
80605ae20b90: Preparing
e269231b9601: Preparing
9c895a85998d: Preparing
ae5637ef40a1: Preparing
70a290c5e58b: Preparing
a6d5ef62e042: Waiting
80605ae20b90: Waiting
e269231b9601: Waiting
9c895a85998d: Waiting
ae5637ef40a1: Waiting
70a290c5e58b: Waiting
bc251b2c8478: Layer already exists
e714c748e694: Layer already exists
28a1f81af219: Layer already exists
1a8392a4176e: Layer already exists
17856622c495: Layer already exists
80605ae20b90: Layer already exists
ae5637ef40a1: Layer already exists
9c895a85998d: Layer already exists
e269231b9601: Layer already exists
70a290c5e58b: Layer already exists
a6d5ef62e042: Layer already exists
latest: digest: sha256:72a75afda00928c7c028ba04748ca52b63321aa909ebd28ae442b21113f088bf size: 2623
[1;33mBuilding frontend image...[0m
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon    332MB
Step 1/12 : FROM node:20-alpine AS builder
 ---> 2b56f2779663
Step 2/12 : WORKDIR /app
 ---> Using cache
 ---> ea0e2c6ff36e
Step 3/12 : COPY package*.json ./
 ---> Using cache
 ---> a03158f0dfa7
Step 4/12 : RUN npm ci --only=production
 ---> Using cache
 ---> 63043788fc69
Step 5/12 : COPY . .
 ---> Using cache
 ---> 7a03d935ee92
Step 6/12 : RUN npm run build
 ---> Using cache
 ---> 525d81be8ce7
Step 7/12 : FROM nginx:alpine
 ---> d4918ca78576
Step 8/12 : COPY --from=builder /app/dist /usr/share/nginx/html
 ---> Using cache
 ---> db9a793e79ab
Step 9/12 : COPY nginx.conf /etc/nginx/conf.d/default.conf
 ---> Using cache
 ---> 8675b302d5db
Step 10/12 : HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3     CMD wget --quiet --tries=1 --spider http://localhost:80/ || exit 1
 ---> Using cache
 ---> ac51ba4be310
Step 11/12 : EXPOSE 80
 ---> Using cache
 ---> 0e8bc3a55b53
Step 12/12 : CMD ["nginx", "-g", "daemon off;"]
 ---> Using cache
 ---> b3b592db1eab
Successfully built b3b592db1eab
Successfully tagged auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend:latest
[1;33mPushing frontend image...[0m
The push refers to repository [auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend]
d677269d0a1f: Preparing
609c2bd64e04: Preparing
25906c27b84d: Preparing
99ea4bde418d: Preparing
3297b9628ff3: Preparing
b74d92be8225: Preparing
2c79d5d895bb: Preparing
2660a7d4b906: Preparing
50b58ca2a3f5: Preparing
256f393e029f: Preparing
2660a7d4b906: Waiting
50b58ca2a3f5: Waiting
b74d92be8225: Waiting
256f393e029f: Waiting
2c79d5d895bb: Waiting
609c2bd64e04: Layer already exists
d677269d0a1f: Layer already exists
3297b9628ff3: Layer already exists
99ea4bde418d: Layer already exists
25906c27b84d: Layer already exists
b74d92be8225: Layer already exists
2c79d5d895bb: Layer already exists
50b58ca2a3f5: Layer already exists
2660a7d4b906: Layer already exists
256f393e029f: Layer already exists
latest: digest: sha256:ef98a719a16d16a7d57101f8b5d021d459aeac6d1370b5ef081ffab5629a3371 size: 2406

[0;32mDeploying Container Apps...[0m
[1;33mLoading environment variables from .env.production[0m
[1;33mDeploying backend container app...[0m
WARNING: Adding registry password as a secret with name "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
/ Running ..| Running ..\ Running ..- Running ../ Running ..| Running ..\ Running ..[KWARNING: 
Container app created. Access your app at https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io/

{
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/containerapps/auditapp-backend",
  "identity": {
    "type": "None"
  },
  "location": "East US",
  "name": "auditapp-backend",
  "properties": {
    "configuration": {
      "activeRevisionsMode": "Single",
      "dapr": null,
      "identitySettings": [],
      "ingress": {
        "additionalPortMappings": null,
        "allowInsecure": false,
        "clientCertificateMode": null,
        "corsPolicy": null,
        "customDomains": null,
        "exposedPort": 0,
        "external": true,
        "fqdn": "auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io",
        "ipSecurityRestrictions": null,
        "stickySessions": null,
        "targetPort": 8000,
        "traffic": [
          {
            "latestRevision": true,
            "weight": 100
          }
        ],
        "transport": "Auto"
      },
      "maxInactiveRevisions": 100,
      "registries": [
        {
          "identity": "",
          "passwordSecretRef": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o",
          "server": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
          "username": "auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "runtime": null,
      "secrets": [
        {
          "name": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "service": null
    },
    "customDomainVerificationId": "75AB1589448DD8722E929BD89B164AAE171F742F6BDBD3261741A5DFD4056DD6",
    "delegatedIdentities": [],
    "environmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "eventStreamEndpoint": "https://eastus.azurecontainerapps.dev/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/containerApps/auditapp-backend/eventstream",
    "latestReadyRevisionName": "auditapp-backend--pa47twk",
    "latestRevisionFqdn": "auditapp-backend--pa47twk.graydune-dadabae1.eastus.azurecontainerapps.io",
    "latestRevisionName": "auditapp-backend--pa47twk",
    "managedEnvironmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "outboundIpAddresses": [
      "51.8.35.135"
    ],
    "provisioningState": "Succeeded",
    "runningStatus": "Running",
    "template": {
      "containers": [
        {
          "env": [
            {
              "name": "ENVIRONMENT"
            },
            {
              "name": "DATABASE_URL"
            },
            {
              "name": "AZURE_OPENAI_ENDPOINT"
            },
            {
              "name": "AZURE_OPENAI_EMBEDDING_DEPLOYMENT"
            },
            {
              "name": "AZURE_OPENAI_CHAT_DEPLOYMENT"
            },
            {
              "name": "AZURE_SEARCH_ENDPOINT"
            },
            {
              "name": "AZURE_SEARCH_API_KEY"
            },
            {
              "name": "AZURE_SEARCH_INDEX_NAME"
            },
            {
              "name": "AZURE_STORAGE_CONNECTION_STRING"
            },
            {
              "name": "AZURE_STORAGE_CONTAINER_NAME"
            },
            {
              "name": "REDIS_URL"
            },
            {
              "name": "VECTOR_DB_TYPE"
            }
          ],
          "image": "auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend:latest",
          "name": "auditapp-backend",
          "resources": {
            "cpu": 1.0,
            "ephemeralStorage": "4Gi",
            "memory": "2Gi"
          }
        }
      ],
      "initContainers": null,
      "revisionSuffix": "",
      "scale": {
        "cooldownPeriod": 300,
        "maxReplicas": 3,
        "minReplicas": 1,
        "pollingInterval": 30,
        "rules": null
      },
      "serviceBinds": null,
      "terminationGracePeriodSeconds": null,
      "volumes": null
    },
    "workloadProfileName": null
  },
  "resourceGroup": "auditapp-staging-rg",
  "systemData": {
    "createdAt": "2025-11-25T17:46:07.9942182",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:46:07.9942182",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.App/containerApps"
}

[0;32mBackend deployed: https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io[0m
[1;33mDeploying frontend container app...[0m
WARNING: Adding registry password as a secret with name "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
/ Running ..| Running ..\ Running ..- Running ../ Running ..| Running ..[KWARNING: 
Container app created. Access your app at https://auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io/

{
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/containerapps/auditapp-frontend",
  "identity": {
    "type": "None"
  },
  "location": "East US",
  "name": "auditapp-frontend",
  "properties": {
    "configuration": {
      "activeRevisionsMode": "Single",
      "dapr": null,
      "identitySettings": [],
      "ingress": {
        "additionalPortMappings": null,
        "allowInsecure": false,
        "clientCertificateMode": null,
        "corsPolicy": null,
        "customDomains": null,
        "exposedPort": 0,
        "external": true,
        "fqdn": "auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io",
        "ipSecurityRestrictions": null,
        "stickySessions": null,
        "targetPort": 80,
        "traffic": [
          {
            "latestRevision": true,
            "weight": 100
          }
        ],
        "transport": "Auto"
      },
      "maxInactiveRevisions": 100,
      "registries": [
        {
          "identity": "",
          "passwordSecretRef": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o",
          "server": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
          "username": "auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "runtime": null,
      "secrets": [
        {
          "name": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "service": null
    },
    "customDomainVerificationId": "75AB1589448DD8722E929BD89B164AAE171F742F6BDBD3261741A5DFD4056DD6",
    "delegatedIdentities": [],
    "environmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "eventStreamEndpoint": "https://eastus.azurecontainerapps.dev/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/containerApps/auditapp-frontend/eventstream",
    "latestReadyRevisionName": "auditapp-frontend--qi74jcd",
    "latestRevisionFqdn": "auditapp-frontend--qi74jcd.graydune-dadabae1.eastus.azurecontainerapps.io",
    "latestRevisionName": "auditapp-frontend--qi74jcd",
    "managedEnvironmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "outboundIpAddresses": [
      "51.8.35.135"
    ],
    "provisioningState": "Succeeded",
    "runningStatus": "Running",
    "template": {
      "containers": [
        {
          "env": [
            {
              "name": "VITE_API_URL"
            }
          ],
          "image": "auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend:latest",
          "name": "auditapp-frontend",
          "resources": {
            "cpu": 0.5,
            "ephemeralStorage": "2Gi",
            "memory": "1Gi"
          }
        }
      ],
      "initContainers": null,
      "revisionSuffix": "",
      "scale": {
        "cooldownPeriod": 300,
        "maxReplicas": 3,
        "minReplicas": 1,
        "pollingInterval": 30,
        "rules": null
      },
      "serviceBinds": null,
      "terminationGracePeriodSeconds": null,
      "volumes": null
    },
    "workloadProfileName": null
  },
  "resourceGroup": "auditapp-staging-rg",
  "systemData": {
    "createdAt": "2025-11-25T17:46:24.0823289",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:46:24.0823289",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.App/containerApps"
}

[0;32m===========================================
Deployment Complete!
===========================================[0m

[0;32mApplication URLs:[0m
  Frontend: https://auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io
  Backend:  https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io
  API Docs: https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io/docs

[1;33mNext Steps:[0m
1. Update CORS in backend to include frontend URL
2. Test the application
3. Monitor logs: az containerapp logs tail --name auditapp-backend -g auditapp-staging-rg

========================================
Audit App - Application Deployment
========================================

[1;33mConfiguration:[0m
  Environment: staging
  Resource Group: auditapp-staging-rg

[0;32mGetting deployment information...[0m
[0;32mGetting deployment information...[0m
  Container Registry: auditappstagingacrwgjuafflp2o4o
  Container Apps Environment: auditapp-staging-containerenv

[0;32mEnabling ACR admin access...[0m
{
  "adminUserEnabled": true,
  "anonymousPullEnabled": false,
  "autoGeneratedDomainNameLabelScope": "Unsecure",
  "creationDate": "2025-11-25T15:17:47.483680+00:00",
  "dataEndpointEnabled": false,
  "dataEndpointHostNames": [],
  "encryption": {
    "keyVaultProperties": null,
    "status": "disabled"
  },
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.ContainerRegistry/registries/auditappstagingacrwgjuafflp2o4o",
  "identity": null,
  "location": "eastus",
  "loginServer": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
  "metadataSearch": "Disabled",
  "name": "auditappstagingacrwgjuafflp2o4o",
  "networkRuleBypassOptions": "AzureServices",
  "networkRuleSet": null,
  "policies": {
    "azureAdAuthenticationAsArmPolicy": {
      "status": "enabled"
    },
    "exportPolicy": {
      "status": "enabled"
    },
    "quarantinePolicy": {
      "status": "disabled"
    },
    "retentionPolicy": {
      "days": 7,
      "lastUpdatedTime": "2025-11-25T15:39:46.744016+00:00",
      "status": "disabled"
    },
    "softDeletePolicy": {
      "lastUpdatedTime": "2025-11-25T15:39:46.744075+00:00",
      "retentionDays": 7,
      "status": "disabled"
    },
    "trustPolicy": {
      "status": "disabled",
      "type": "Notary"
    }
  },
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": "Enabled",
  "resourceGroup": "auditapp-staging-rg",
  "roleAssignmentMode": "LegacyRegistryPermissions",
  "sku": {
    "name": "Basic",
    "tier": "Basic"
  },
  "status": null,
  "systemData": {
    "createdAt": "2025-11-25T15:17:47.483680+00:00",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:50:56.765681+00:00",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "tags": {
    "Application": "AuditApp",
    "Environment": "staging",
    "ManagedBy": "Bicep"
  },
  "type": "Microsoft.ContainerRegistry/registries",
  "zoneRedundancy": "Disabled"
}

[0;32mBuilding and pushing Docker images...[0m
[1;33mBuilding backend image...[0m
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon    542MB
Step 1/12 : FROM python:3.12-slim
 ---> 445121148b18
Step 2/12 : WORKDIR /app
 ---> Using cache
 ---> 2284d0cea4d9
Step 3/12 : RUN apt-get update && apt-get install -y     gcc     g++     libpq-dev     libmagic1     curl     && rm -rf /var/lib/apt/lists/*
 ---> Using cache
 ---> f6873aac0949
Step 4/12 : COPY requirements.txt .
 ---> Using cache
 ---> 5040f9f29a4e
Step 5/12 : RUN pip install --no-cache-dir -r requirements.txt &&     pip install --no-cache-dir 'numpy<2.0'
 ---> Using cache
 ---> 171d93300fb0
Step 6/12 : COPY app/ ./app/
 ---> 822e8cdb017b
Step 7/12 : RUN mkdir -p /app/data
 ---> Running in 7b3b6d830620
 ---> Removed intermediate container 7b3b6d830620
 ---> dfd5a5731a52
Step 8/12 : RUN useradd -m -u 1000 appuser &&     chown -R appuser:appuser /app
 ---> Running in 10b9a571dd82
 ---> Removed intermediate container 10b9a571dd82
 ---> b03b8093b5de
Step 9/12 : USER appuser
 ---> Running in af12675f3bca
 ---> Removed intermediate container af12675f3bca
 ---> 7178d5677894
Step 10/12 : HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3     CMD curl -f http://localhost:8000/health || exit 1
 ---> Running in 024e1792976e
 ---> Removed intermediate container 024e1792976e
 ---> dc15b16b40cb
Step 11/12 : EXPOSE 8000
 ---> Running in 4c22fc5c98c8
 ---> Removed intermediate container 4c22fc5c98c8
 ---> c87ba2ef4d40
Step 12/12 : CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
 ---> Running in abc263e492b2
 ---> Removed intermediate container abc263e492b2
 ---> 4117d613393f
Successfully built 4117d613393f
Successfully tagged auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend:latest
[1;33mPushing backend image...[0m
Login Succeeded
The push refers to repository [auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend]
57972ba3857f: Preparing
44948a3c3388: Preparing
a267dc71f107: Preparing
bc251b2c8478: Preparing
1a8392a4176e: Preparing
a6d5ef62e042: Preparing
80605ae20b90: Preparing
e269231b9601: Preparing
9c895a85998d: Preparing
ae5637ef40a1: Preparing
70a290c5e58b: Preparing
a6d5ef62e042: Waiting
80605ae20b90: Waiting
e269231b9601: Waiting
9c895a85998d: Waiting
ae5637ef40a1: Waiting
70a290c5e58b: Waiting
1a8392a4176e: Layer already exists
bc251b2c8478: Layer already exists
a6d5ef62e042: Layer already exists
80605ae20b90: Layer already exists
e269231b9601: Layer already exists
9c895a85998d: Layer already exists
ae5637ef40a1: Layer already exists
70a290c5e58b: Layer already exists
44948a3c3388: Pushed
a267dc71f107: Pushed
57972ba3857f: Pushed
latest: digest: sha256:367c18b046c6302a6fb7742f6c128ab40b9cc5968191b5ba7ca2edd8b5090909 size: 2623
[1;33mBuilding frontend image...[0m
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon    332MB
Step 1/12 : FROM node:20-alpine AS builder
 ---> 2b56f2779663
Step 2/12 : WORKDIR /app
 ---> Using cache
 ---> ea0e2c6ff36e
Step 3/12 : COPY package*.json ./
 ---> df89aefde07b
Step 4/12 : RUN npm ci --only=production
 ---> Running in 2dd860328fc2
[91mnpm warn config only Use `--omit=dev` to omit dev dependencies from the install.
[0m[91mnpm warn deprecated rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
[0m[91mnpm warn deprecated npmlog@5.0.1: This package is no longer supported.
[0m[91mnpm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
[0m[91mnpm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
[0m[91mnpm warn deprecated are-we-there-yet@2.0.0: This package is no longer supported.
[0m[91mnpm warn deprecated gauge@3.0.2: This package is no longer supported.
[0m
added 81 packages, and audited 82 packages in 3s

11 packages are looking for funding
  run `npm fund` for details

2 high severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
[91mnpm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.3
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.3
npm notice To update run: npm install -g npm@11.6.3
npm notice
[0m ---> Removed intermediate container 2dd860328fc2
 ---> abb530b9b190
Step 5/12 : COPY . .
 ---> dd57c97ca22d
Step 6/12 : RUN npm run build
 ---> Running in 7e4baf059100

> audit-app-frontend@1.1.0 build
> vite build

vite v5.4.21 building for production...
transforming...
âœ“ 1961 modules transformed.
[91mnode_modules/pdfjs-dist/build/pdf.js (1982:23): Use of eval in "node_modules/pdfjs-dist/build/pdf.js" is strongly discouraged as it poses security risks and may cause issues with minification.
[0mrendering chunks...
computing gzip size...
dist/index.html                     0.47 kB â”‚ gzip:   0.31 kB
dist/assets/index-BV82LkYu.css     26.13 kB â”‚ gzip:   5.45 kB
dist/assets/index-CJs2B65c.js   1,214.79 kB â”‚ gzip: 332.37 kB
[91m
(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
[0mâœ“ built in 5.18s
 ---> Removed intermediate container 7e4baf059100
 ---> 32a90be6ec4f
Step 7/12 : FROM nginx:alpine
 ---> d4918ca78576
Step 8/12 : COPY --from=builder /app/dist /usr/share/nginx/html
 ---> 226ea37f8069
Step 9/12 : COPY nginx.conf /etc/nginx/conf.d/default.conf
 ---> cd6f1f0e8b89
Step 10/12 : HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3     CMD wget --quiet --tries=1 --spider http://localhost:80/ || exit 1
 ---> Running in 8923f3c2f4e2
 ---> Removed intermediate container 8923f3c2f4e2
 ---> 5cca6ed9c039
Step 11/12 : EXPOSE 80
 ---> Running in 3290f5ba8af7
 ---> Removed intermediate container 3290f5ba8af7
 ---> ae331a50a238
Step 12/12 : CMD ["nginx", "-g", "daemon off;"]
 ---> Running in 73f838ccf2ad
 ---> Removed intermediate container 73f838ccf2ad
 ---> 44fa98b7c5b2
Successfully built 44fa98b7c5b2
Successfully tagged auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend:latest
[1;33mPushing frontend image...[0m
The push refers to repository [auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend]
22344a40ef61: Preparing
1d68c30780a9: Preparing
25906c27b84d: Preparing
99ea4bde418d: Preparing
3297b9628ff3: Preparing
b74d92be8225: Preparing
2c79d5d895bb: Preparing
2660a7d4b906: Preparing
50b58ca2a3f5: Preparing
256f393e029f: Preparing
b74d92be8225: Waiting
2c79d5d895bb: Waiting
2660a7d4b906: Waiting
50b58ca2a3f5: Waiting
256f393e029f: Waiting
25906c27b84d: Layer already exists
99ea4bde418d: Layer already exists
3297b9628ff3: Layer already exists
b74d92be8225: Layer already exists
2660a7d4b906: Layer already exists
2c79d5d895bb: Layer already exists
50b58ca2a3f5: Layer already exists
256f393e029f: Layer already exists
22344a40ef61: Pushed
1d68c30780a9: Pushed
latest: digest: sha256:a371dd1f320f4bbe5618c4a8942712cc7071ce274ffdfe13588509e7459dc546 size: 2406

[0;32mDeploying Container Apps...[0m
[1;33mLoading environment variables from .env.production[0m
[1;33mDeploying backend container app...[0m
WARNING: Adding registry password as a secret with name "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
/ Running ..| Running ..\ Running ..- Running ../ Running ..| Running ..\ Running ..[KWARNING: 
Container app created. Access your app at https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io/

{
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/containerapps/auditapp-backend",
  "identity": {
    "type": "None"
  },
  "location": "East US",
  "name": "auditapp-backend",
  "properties": {
    "configuration": {
      "activeRevisionsMode": "Single",
      "dapr": null,
      "identitySettings": [],
      "ingress": {
        "additionalPortMappings": null,
        "allowInsecure": false,
        "clientCertificateMode": null,
        "corsPolicy": null,
        "customDomains": null,
        "exposedPort": 0,
        "external": true,
        "fqdn": "auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io",
        "ipSecurityRestrictions": null,
        "stickySessions": null,
        "targetPort": 8000,
        "traffic": [
          {
            "latestRevision": true,
            "weight": 100
          }
        ],
        "transport": "Auto"
      },
      "maxInactiveRevisions": null,
      "registries": [
        {
          "identity": "",
          "passwordSecretRef": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o",
          "server": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
          "username": "auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "runtime": null,
      "secrets": [
        {
          "name": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "service": null
    },
    "customDomainVerificationId": "75AB1589448DD8722E929BD89B164AAE171F742F6BDBD3261741A5DFD4056DD6",
    "delegatedIdentities": [],
    "environmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "eventStreamEndpoint": "https://eastus.azurecontainerapps.dev/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/containerApps/auditapp-backend/eventstream",
    "latestReadyRevisionName": "auditapp-backend--pa47twk",
    "latestRevisionFqdn": "auditapp-backend--0000001.graydune-dadabae1.eastus.azurecontainerapps.io",
    "latestRevisionName": "auditapp-backend--0000001",
    "managedEnvironmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "outboundIpAddresses": [
      "51.8.35.135"
    ],
    "provisioningState": "Succeeded",
    "runningStatus": "Running",
    "template": {
      "containers": [
        {
          "env": [
            {
              "name": "ENVIRONMENT"
            },
            {
              "name": "DATABASE_URL"
            },
            {
              "name": "AZURE_OPENAI_ENDPOINT"
            },
            {
              "name": "AZURE_OPENAI_EMBEDDING_DEPLOYMENT"
            },
            {
              "name": "AZURE_OPENAI_CHAT_DEPLOYMENT"
            },
            {
              "name": "AZURE_SEARCH_ENDPOINT"
            },
            {
              "name": "AZURE_SEARCH_API_KEY"
            },
            {
              "name": "AZURE_SEARCH_INDEX_NAME"
            },
            {
              "name": "AZURE_STORAGE_CONNECTION_STRING"
            },
            {
              "name": "AZURE_STORAGE_CONTAINER_NAME"
            },
            {
              "name": "REDIS_URL"
            },
            {
              "name": "VECTOR_DB_TYPE"
            }
          ],
          "image": "auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-backend:latest",
          "name": "auditapp-backend",
          "resources": {
            "cpu": 1.0,
            "ephemeralStorage": "4Gi",
            "memory": "2Gi"
          }
        }
      ],
      "initContainers": null,
      "revisionSuffix": "",
      "scale": {
        "cooldownPeriod": 300,
        "maxReplicas": 3,
        "minReplicas": 1,
        "pollingInterval": 30,
        "rules": null
      },
      "serviceBinds": null,
      "terminationGracePeriodSeconds": null,
      "volumes": null
    },
    "workloadProfileName": null
  },
  "resourceGroup": "auditapp-staging-rg",
  "systemData": {
    "createdAt": "2025-11-25T17:46:07.9942182",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:52:01.865344",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.App/containerApps"
}

[0;32mBackend deployed: https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io[0m
[1;33mDeploying frontend container app...[0m
WARNING: Adding registry password as a secret with name "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
/ Running ..| Running ..\ Running ..- Running ../ Running ..| Running ..[KWARNING: 
Container app created. Access your app at https://auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io/

{
  "id": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/containerapps/auditapp-frontend",
  "identity": {
    "type": "None"
  },
  "location": "East US",
  "name": "auditapp-frontend",
  "properties": {
    "configuration": {
      "activeRevisionsMode": "Single",
      "dapr": null,
      "identitySettings": [],
      "ingress": {
        "additionalPortMappings": null,
        "allowInsecure": false,
        "clientCertificateMode": null,
        "corsPolicy": null,
        "customDomains": null,
        "exposedPort": 0,
        "external": true,
        "fqdn": "auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io",
        "ipSecurityRestrictions": null,
        "stickySessions": null,
        "targetPort": 80,
        "traffic": [
          {
            "latestRevision": true,
            "weight": 100
          }
        ],
        "transport": "Auto"
      },
      "maxInactiveRevisions": null,
      "registries": [
        {
          "identity": "",
          "passwordSecretRef": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o",
          "server": "auditappstagingacrwgjuafflp2o4o.azurecr.io",
          "username": "auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "runtime": null,
      "secrets": [
        {
          "name": "auditappstagingacrwgjuafflp2o4oazurecrio-auditappstagingacrwgjuafflp2o4o"
        }
      ],
      "service": null
    },
    "customDomainVerificationId": "75AB1589448DD8722E929BD89B164AAE171F742F6BDBD3261741A5DFD4056DD6",
    "delegatedIdentities": [],
    "environmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "eventStreamEndpoint": "https://eastus.azurecontainerapps.dev/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/containerApps/auditapp-frontend/eventstream",
    "latestReadyRevisionName": "auditapp-frontend--qi74jcd",
    "latestRevisionFqdn": "auditapp-frontend--qi74jcd.graydune-dadabae1.eastus.azurecontainerapps.io",
    "latestRevisionName": "auditapp-frontend--qi74jcd",
    "managedEnvironmentId": "/subscriptions/5174be66-ca82-423c-b405-259414906e7c/resourceGroups/auditapp-staging-rg/providers/Microsoft.App/managedEnvironments/auditapp-staging-containerenv",
    "outboundIpAddresses": [
      "51.8.35.135"
    ],
    "provisioningState": "Succeeded",
    "runningStatus": "Running",
    "template": {
      "containers": [
        {
          "env": [
            {
              "name": "VITE_API_URL"
            }
          ],
          "image": "auditappstagingacrwgjuafflp2o4o.azurecr.io/auditapp-frontend:latest",
          "name": "auditapp-frontend",
          "resources": {
            "cpu": 0.5,
            "ephemeralStorage": "2Gi",
            "memory": "1Gi"
          }
        }
      ],
      "initContainers": null,
      "revisionSuffix": "",
      "scale": {
        "cooldownPeriod": 300,
        "maxReplicas": 3,
        "minReplicas": 1,
        "pollingInterval": 30,
        "rules": null
      },
      "serviceBinds": null,
      "terminationGracePeriodSeconds": null,
      "volumes": null
    },
    "workloadProfileName": null
  },
  "resourceGroup": "auditapp-staging-rg",
  "systemData": {
    "createdAt": "2025-11-25T17:46:24.0823289",
    "createdBy": "sandeep.lingam@sbscyber.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-11-25T17:52:17.8656952",
    "lastModifiedBy": "sandeep.lingam@sbscyber.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.App/containerApps"
}

[0;32m===========================================
Deployment Complete!
===========================================[0m

[0;32mApplication URLs:[0m
  Frontend: https://auditapp-frontend.graydune-dadabae1.eastus.azurecontainerapps.io
  Backend:  https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io
  API Docs: https://auditapp-backend.graydune-dadabae1.eastus.azurecontainerapps.io/docs

[1;33mNext Steps:[0m
1. Update CORS in backend to include frontend URL
2. Test the application
3. Monitor logs: az containerapp logs tail --name auditapp-backend -g auditapp-staging-rg

